{% extends "base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="no">
<head>
<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 d-none d-md-block sidebar">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.index') }}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('robot_fleet.robot_fleet') }}"><i class="fas fa-ship"></i> Flåteoversikt</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-briefcase"></i> Oppdrag</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('history.history') }}"><i class="fas fa-history"></i> Historikk</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-bell"></i> Notifikasjoner</a>
                    </li>
                    <li class="nav-item mt-auto">
                        <a class="nav-link" href="#"><i class="fas fa-cog"></i> Innstillinger</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-sign-out-alt"></i> Logg Ut</a>
                    </li>                                     
                </ul>
            </nav>
            <main role="main" class="col-md-10 ml-sm-auto col-lg-10 px-4">
            </br>
            </br>
                <h2>Oppdrag</h2>
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Oppdragsnavn</th>
                            <th>Sist fullført</th>
                            <th>Frist</th>
                            <th>Kjør oppdrag</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ingen planlagt inspeksjon</td>
                            <td>Maintenance level 1</td>
                            <td>10.12.2023</td>
                            <td>12.02.2024</td>
                            <td><i class="fas fa-plus-circle start-mission" data-mission='{"id":"1","tasks":[{"steps":[{"type":"drive_to_pose","pose":{"position":{"x":-2,"y":-2,"z":0,"frame":"asset"},"orientation":{"x":0,"y":0,"z":0.4794255,"w":0.8775826,"frame":"asset"},"frame":"asset"}},{"type":"take_image","target":{"x":2,"y":2,"z":0,"frame":"robot"}}]}]}'></i></td>
                        </tr>
                        <tr>
                            <td>Ingen planlagt inspeksjon</td>
                            <td>Base test</td>
                            <td>Aldri fullført</td>
                            <td>N/A</td>
                            <td><i class="fas fa-plus-circle"></i></td>
                        </tr>
                        <tr>
                            <td>Planlagt for i morgen</td>
                            <td>Maintenance level 2</td>
                            <td>12.01.2024</td>
                            <td>12.02.2024</td>
                            <td><i class="fas fa-plus-circle"></i></td>
                        </tr>
                        <tr>
                            <td>No planned inspection</td>
                            <td>Pipeline valve inspection</td>
                            <td>Aldri fullført</td>
                            <td>12.02.2024</td>
                            <td><i class="fas fa-plus-circle"></i></td>
                        </tr>
                    </tbody>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const startButtons = document.querySelectorAll('.start-mission');
                
                            startButtons.forEach(button => {
                                button.addEventListener('click', function() {
                                    const missionData = this.getAttribute('data-mission');
                                    startPredefinedMission(JSON.parse(missionData));
                                });
                            });
                        });
                
                        function startPredefinedMission() {
                            const predefinedMission = {
                                "id": "1",
                                "tasks": [
                                    {
                                        "steps": [
                                            {
                                                "type": "drive_to_pose",
                                                "pose": {
                                                    "position": {
                                                        "x": -2,
                                                        "y": -2,
                                                        "z": 0,
                                                        "frame": "asset"
                                                    },
                                                    "orientation": {
                                                        "x": 0,
                                                        "y": 0,
                                                        "z": 0.4794255,
                                                        "w": 0.8775826,
                                                        "frame": "asset"
                                                    },
                                                    "frame": "asset"
                                                }
                                            },
                                            {
                                                "type": "take_image",
                                                "target": {
                                                    "x": 2,
                                                    "y": 2,
                                                    "z": 0,
                                                    "frame": "robot"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            };

                            fetch('/start-mission', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(predefinedMission)
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                return response.json();
                            })
                            .then(data => {
                                alert('Oppdrag har startet');
                            })
                            .catch((error) => {
                                console.error('Error starting mission:', error);
                                alert('Feil ved start av oppdrag: ' + error.message);
                            });
                        }

                        function appendLog(container, log) {
                            var logElement = document.createElement('p');
                            logElement.textContent = log;
                            container.appendChild(logElement);
                        }
                    </script>
                </table>
                <div class="text-right">
                    <button class="btn btn-success">+ Legg til oppdrag</button>
                    <button class="btn btn-primary">Administrer oppdragsliste</button>
                </div>             
            </main>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
{% endblock %}